{% extends "admin/base.html" %}

{% block content %}
<div id="boxes">
</div>
{% endblock %}

{% block scripts %}
<script>
    //Functional programming :)
    new Promise(async (resolve, reject) => {
        let resp = await fetch("/api/UMASS/get_boxes");
        let json = await resp.json();
        let data = json.Data.networks;
        //iterate through json returned by ctfd plugin
        for (const network of json.Data.networks) {
            //each "network" will have its own div
            let divToAdd = document.createElement('div');
            divToAdd.innerText = network.name;
            //Each div will have a table of the containers/labs
            let table = document.createElement('table');
            let tr = document.createElement('tr');
            //Table titles
            ["Container Name","Description","Start","Stop","Reset"].forEach(name=>{
                let th = document.createElement('th');
                th.textContent = name;
                tr.appendChild(th);

            })
            table.appendChild(tr);

            //Create a row for each lab and populate columns
            for(const lab of network.labs){
                tr = document.createElement('tr');
                [lab.container_name,lab.description,"start","stop","reset"].forEach((text)=>{
                    let td = document.createElement('td');
                    if(text=="start" || text=="stop" || text=="reset"){
                        let button = document.createElement('button');
                        button.onclick = async ()=>{
                            await fetch(`/api/UMASS/${text}_box`,{
                                method:"POST",
                                headers:{
                                    'Content-Type':'application/json'
                                },
                                body: JSON.stringify({
                                    "container_name":lab.container_name
                                })
                                
                            })
                        }
                        button.textContent = text;
                        td.appendChild(button);
                    }
                    else
                        td.textContent = text;
                    tr.appendChild(td);
                })
                table.appendChild(tr);
            }
            //Add the table to div and div to boxes
            divToAdd.appendChild(table);
            document.getElementById("boxes").appendChild(divToAdd);

        }
        resolve(resp);
    })

</script>
{% endblock %}